{% extends "base.html" %}
{% load evewire %}

{% block title %}Skills - {{ character.name }} - evewire{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h1>Skills - {{ character.name }}</h1>
    <a href="{% url 'core:character_detail' character.id %}">Back to Character</a>
</div>

<div class="card">
    <h2>Filter Skills</h2>
    <form method="get" style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
        <input type="text" name="search" placeholder="Search skills..." value="{{ search }}" style="padding: 0.5rem;">
        <select name="min_level" style="padding: 0.5rem;">
            <option value="">All Levels</option>
            <option value="1" {% if min_level == '1' %}selected{% endif %}>Level 1+</option>
            <option value="2" {% if min_level == '2' %}selected{% endif %}>Level 2+</option>
            <option value="3" {% if min_level == '3' %}selected{% endif %}>Level 3+</option>
            <option value="4" {% if min_level == '4' %}selected{% endif %}>Level 4+</option>
            <option value="5" {% if min_level == '5' %}selected{% endif %}>Level 5</option>
        </select>
        <button type="submit" class="btn">Filter</button>
        <a href="{% url 'core:skills_list' %}" style="margin-left: 0.5rem;">Clear</a>
    </form>
</div>

<div class="card">
    <h2>
        {% if search or min_level %}
            Filtered Skills
            ({{ skill_groups.values|list|length }} group{{ skill_groups.values|list|length|pluralize }})
        {% else %}
            All Skills ({{ skill_groups.values|list|length }} groups)
        {% endif %}
    </h2>

    {% if skill_groups %}
        <div class="skill-groups-accordion">
            {% for group_name, skills in skill_groups.items %}
                <details class="skill-group" {% if not search %}open{% endif %} style="margin-bottom: 0.5rem;">
                    <summary style="cursor: pointer; padding: 0.75rem; background: #f5f5f5; border-radius: 4px; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
                        <span>â–¼ {{ group_name }} ({{ skills|length }} skill{{ skills|length|pluralize }})</span>
                    </summary>
                    <div style="padding: 0.5rem 0;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tbody>
                                {% for skill in skills %}
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="padding: 0.5rem;">
                                        <span style="color: {% if skill.skill_level == 5 %}#c00{% elif skill.skill_level == 4 %}#c60{% elif skill.skill_level == 3 %}#c90{% else %}#666{% endif %}; font-weight: bold; font-size: 1.1rem; margin-right: 0.5rem;">
                                            {{ skill.skill_level|skill_squares }}
                                        </span>
                                        <strong>{{ skill.skill_name }}</strong>
                                        <span style="color: #666; font-size: 0.9rem; margin-left: 0.5rem;">({{ skill.primary_attribute }}/{{ skill.secondary_attribute }})</span>
                                    </td>
                                    <td style="padding: 0.5rem; text-align: right; color: #666;">
                                        {{ skill.skillpoints_in_skill|commas }}
                                        {% if skill.sp_for_next_level > 0 %}
                                            / {{ skill.sp_for_next_level|commas }}
                                        {% endif %}
                                        SP
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </details>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #666;">No skills match your filter.</p>
    {% endif %}
</div>

<div class="card">
    <h2>Skill Statistics</h2>
    <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
        <div>
            <strong>Total SP:</strong> {{ character.total_sp|default:0|commas }}
        </div>
        <div>
            <strong>Trained Skills:</strong> {{ character.skills.count }}
        </div>
        <div>
            <strong>Skill Groups:</strong> {{ skill_groups.keys|list|length }}
        </div>
        <div>
            <strong>Level 5 Skills:</strong> {% for group_skills in skill_groups.values %}{{ group_skills|selectattr:"skill_level"|equal:"5"|list|length }}{% empty %}0{% endfor %}
        </div>
    </div>
</div>
{% endblock %}
