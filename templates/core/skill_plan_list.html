{% extends "base.html" %}
{% load evewire %}

{% block title %}Skill Plans - evewire{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h1>Skill Plans</h1>
    <div>
        <a href="{% url 'core:skill_plan_import' %}" class="btn" style="margin-right: 0.5rem;">Import Plan</a>
        <form method="post" action="{% url 'core:skill_plan_create' %}" style="display: inline;">
            {% csrf_token %}
            <input type="text" name="name" placeholder="Plan name" required style="padding: 0.5rem; margin-right: 0.5rem;">
            <button type="submit" class="btn">Create Plan</button>
        </form>
    </div>
</div>

{% if reference_plans %}
<div class="card" style="margin-bottom: 1rem;">
    <h2>Reference Plans</h2>
    <p style="color: #666; margin-bottom: 1rem;">Shared skill plan templates from the alliance. View details to check your progress.</p>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #ddd;">
                <th style="padding: 0.5rem; text-align: left;">Plan</th>
                <th style="padding: 0.5rem; text-align: center;">Entries</th>
            </tr>
        </thead>
        <tbody>
            {% for plan in reference_plans %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 0.5rem;">
                    <a href="{% url 'core:skill_plan_detail' plan.id %}" style="font-weight: bold; text-decoration: none;">{{ plan.name }}</a>
                </td>
                <td style="padding: 0.5rem; text-align: center;">{{ plan.entries.count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="card">
    <h2>My Plans</h2>
    {% if user_plans %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #ddd;">
                    <th style="padding: 0.5rem; text-align: left;">Plan</th>
                    <th style="padding: 0.5rem; text-align: left;">Description</th>
                    <th style="padding: 0.5rem; text-align: center;">Entries</th>
                    <th style="padding: 0.5rem; text-align: left;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for plan in user_plans %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 0.5rem;">
                        <a href="{% url 'core:skill_plan_detail' plan.id %}" style="font-weight: bold; text-decoration: none;">{{ plan.name }}</a>
                    </td>
                    <td style="padding: 0.5rem; color: #666;">{{ plan.description|default:"&mdash;"|truncatewords:10 }}</td>
                    <td style="padding: 0.5rem; text-align: center;">{{ plan.entries.count }}</td>
                    <td style="padding: 0.5rem;">
                        <a href="{% url 'core:skill_plan_edit' plan.id %}" style="margin-right: 0.5rem;">Edit</a>
                        <form method="post" action="{% url 'core:skill_plan_delete' plan.id %}" style="display: inline;" onsubmit="return confirm('Delete this plan?');">
                            {% csrf_token %}
                            <button type="submit" style="background: none; border: none; color: #c00; cursor: pointer; text-decoration: underline;">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p style="color: #666;">No skill plans yet. Create your first plan to track your training goals!</p>
    {% endif %}
</div>
{% endblock %}
