{% extends "base.html" %}
{% load evewire %}

{% block title %}Skills - {{ character.character_name }} - evewire{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h1>Skills - {{ character.character_name }}</h1>
    <a href="{% url 'core:character_detail' character.id %}">‚Üê Back to Character</a>
</div>

<div class="card">
    <h2>Skill Summary</h2>
    <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
        <div>
            <strong>Total SP:</strong> {{ total_sp|commas }}
        </div>
        <div>
            <strong>Total Skills:</strong> {{ total_skills }}
        </div>
        <div>
            <strong>Skill Groups:</strong> {{ total_groups }}
        </div>
    </div>
</div>

<!-- Category Filter -->
<div class="card" style="margin-top: 1.5rem;">
    <form method="get" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
        <div>
            <label for="category" style="display: block; margin-bottom: 0.25rem; font-size: 0.9rem;">Filter by Category:</label>
            <select name="category" id="category" style="padding: 0.5rem; border-radius: 4px; border: 1px solid var(--border-color); min-width: 250px;">
                <option value="">All Categories</option>
                {% for cat in available_categories %}
                <option value="{{ cat.name }}" {% if category_filter == cat.name %}selected{% endif %}>
                    {{ cat.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn">Apply Filter</button>
        {% if category_filter %}
        <a href="{% url 'core:character_skills' character.id %}" class="btn" style="background: var(--text-secondary);">Clear Filter</a>
        {% endif %}
    </form>
</div>

<div class="card" style="margin-top: 1.5rem;">
    <h2>All Skills ({{ total_skills }} trained)</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 3px solid var(--border-color, #ddd); background: var(--bg-primary, #f5f5f5);">
                <th style="padding: 0.75rem; text-align: left;">Skill</th>
                <th style="padding: 0.75rem; text-align: center; width: 150px;">Level</th>
                <th style="padding: 0.75rem; text-align: right; width: 120px;">Skill Points</th>
            </tr>
        </thead>
        <tbody>
            {% regroup skills by group_name as skills_by_group %}
            {% for group in skills_by_group %}
            <tr class="group-header">
                <td colspan="3" style="padding: 0.5rem 0.75rem; background: var(--bg-secondary, #e8e8e8); font-weight: 600; color: var(--text-secondary);">
                    {{ group.grouper }}
                </td>
            </tr>
            {% for skill in group.list %}
            <tr style="border-bottom: 1px solid var(--table-border, #eee);">
                <td style="padding: 0.6rem 0.75rem;">
                    {{ skill.name }}
                </td>
                <td style="padding: 0.6rem 0.75rem; text-align: center;">
                    <span style="color: {% if skill.skill.skill_level == 5 %}#c00{% elif skill.skill.skill_level == 4 %}#c60{% elif skill.skill.skill_level == 3 %}#c90{% else %}#666{% endif %}; font-weight: bold; font-size: 1.1rem; letter-spacing: 3px;">
                        {{ skill.level_stars }}
                    </span>
                </td>
                <td style="padding: 0.6rem 0.75rem; text-align: right; font-family: monospace;">
                    {{ skill.skill.skillpoints_in_skill|default:0|commas }}
                </td>
            </tr>
            {% endfor %}
            {% endfor %}
            {% if not skills %}
            <tr>
                <td colspan="3" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                    No skills found. Please sync your character.
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<style>
tr.group-header td {
    border-top: 2px solid var(--border-color, #ccc);
}
</style>
{% endblock %}
