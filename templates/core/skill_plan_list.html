{% extends "base.html" %}
{% load evewire %}

{% block title %}Skill Plans - evewire{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h1>Skill Plans</h1>
    <div>
        <a href="{% url 'core:skill_plan_import' %}" class="btn" style="margin-right: 0.5rem;">Import Plan</a>
        <form method="post" action="{% url 'core:skill_plan_create' %}" style="display: inline;">
            {% csrf_token %}
            <input type="text" name="name" placeholder="Plan name" required style="padding: 0.5rem; margin-right: 0.5rem;">
            <button type="submit" class="btn">Create Plan</button>
        </form>
    </div>
</div>

{% if reference_plans %}
<div style="margin-bottom: 2rem;">
    <h2>Reference Plans</h2>
    <p style="color: #666; margin-bottom: 1rem;">Shared skill plan templates from the alliance. View details to check your progress.</p>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
        {% for item in reference_plans %}
        <div class="card" style="margin: 0;">
            <h3 style="margin: 0 0 0.5rem 0;">
                <a href="{% url 'core:skill_plan_detail' item.plan.id %}" style="text-decoration: none; color: inherit;">{{ item.plan.name }}</a>
            </h3>
            {% if item.plan.description %}
            <p style="color: #666; margin: 0 0 0.5rem 0; font-size: 0.9rem;">{{ item.plan.description|truncatewords:15 }}</p>
            {% endif %}
            <div style="display: flex; gap: 1rem; font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">
                <span>{{ item.entry_count }} skills</span>
                {% if item.total_training_seconds %}
                <span>{{ item.total_training_seconds|format_duration }}</span>
                {% endif %}
            </div>
            {% if item.progress %}
            <div style="margin-top: 0.5rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.9rem;">
                    <span>{{ item.progress.percent_complete|floatformat:0 }}% Complete</span>
                    <span>{{ item.progress.completed }}/{{ item.progress.total_entries }}</span>
                </div>
                <div style="background: #eee; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div style="background: #080; height: 100%; width: {{ item.progress.percent_complete }}%;"></div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div>
    <h2>My Plans</h2>
    {% if user_plans %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
            {% for item in user_plans %}
            <div class="card" style="margin: 0;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <h3 style="margin: 0 0 0.5rem 0;">
                        <a href="{% url 'core:skill_plan_detail' item.plan.id %}" style="text-decoration: none; color: inherit;">{{ item.plan.name }}</a>
                    </h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="{% url 'core:skill_plan_edit' item.plan.id %}" style="font-size: 0.9rem;">Edit</a>
                        <form method="post" action="{% url 'core:skill_plan_delete' item.plan.id %}" style="display: inline;" onsubmit="return confirm('Delete this plan?');">
                            {% csrf_token %}
                            <button type="submit" style="background: none; border: none; color: #c00; cursor: pointer; text-decoration: underline; font-size: 0.9rem; padding: 0;">Delete</button>
                        </form>
                    </div>
                </div>
                {% if item.plan.description %}
                <p style="color: #666; margin: 0 0 0.5rem 0; font-size: 0.9rem;">{{ item.plan.description|truncatewords:15 }}</p>
                {% endif %}
                <div style="display: flex; gap: 1rem; font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">
                    <span>{{ item.entry_count }} skills</span>
                    {% if item.total_training_seconds %}
                    <span>{{ item.total_training_seconds|format_duration }}</span>
                    {% endif %}
                </div>
                {% if item.progress %}
                <div style="margin-top: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.9rem;">
                        <span>{{ item.progress.percent_complete|floatformat:0 }}% Complete</span>
                        <span>{{ item.progress.completed }}/{{ item.progress.total_entries }}</span>
                    </div>
                    <div style="background: #eee; height: 8px; border-radius: 4px; overflow: hidden;">
                        <div style="background: #080; height: 100%; width: {{ item.progress.percent_complete }}%;"></div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #666;">No skill plans yet. Create your first plan to track your training goals!</p>
    {% endif %}
</div>
{% endblock %}
